#cloud-config
autoinstall:
  version: 1
  refresh-installer:
    # Comment to use stable channel or uncomment to use channel edge to get the last installer
    # channel: edge
    update: yes
  locale: en_US.UTF-8
  keyboard:
    layout: es
    variant: winkeys
  identity:
    hostname: ubuntu20
    username: packer
    password: '$6$aeYb8Jha$6HA.tG1O6Bv/zb9CN3yACLw3RngGuFWibj68ztdVFjXuWrBzVHMF15aBh9BxUL7yBm3yZjXYi9Hs1Dtps0riE0'
  network:
    version: 2
    ethernets:
      eth0:
        dhcp4: true
        dhcp6: true
      eth1:
        dhcp4: true
        dhcp6: true
      eth2:
        dhcp4: true
        dhcp6: true
      eth3:
        dhcp4: true
        dhcp6: true
      eth4:
        dhcp4: true
        dhcp6: true
      eth5:
        dhcp4: true
        dhcp6: true
  user-data:
    disable_root: true
    hostname: ubuntu20
    preserve_hostname: false
    timezone: Europe/Madrid
    users:
      - name: packer
        passwd: '$6$aeYb8Jha$6HA.tG1O6Bv/zb9CN3yACLw3RngGuFWibj68ztdVFjXuWrBzVHMF15aBh9BxUL7yBm3yZjXYi9Hs1Dtps0riE0'
        groups: [adm, cdrom, dip, lxd, plugdev, sudo, dialout]
        lock-passwd: false
        sudo: ALL=(ALL) NOPASSWD:ALL
        shell: /bin/bash
  ssh:
    install-server: true
    allow-pw: true
  late-commands:
    - |
      echo "START_INSTALL_SECTION $(date '+%Y%m%d_%H%M%S')" >> /dev/ttyS0
      curtin in-target --target=/target -- /usr/bin/timedatectl set-timezone "Europe/Madrid"
      curtin in-target --target=/target -- /usr/bin/timedatectl set-local-rtc false
      curtin in-target --target=/target -- /usr/sbin/locale-gen en_US.UTF-8
      curtin in-target --target=/target -- /usr/sbin/locale-gen es_ES.UTF-8
      curtin in-target --target=/target -- /usr/bin/localectl set-keymap es pc105 winkeys
      curtin in-target --target=/target -- /usr/bin/localectl set-locale en_US.UTF-8
      sed -r -i -e 's/(GRUB_TIMEOUT=).*/\11/g' /target/etc/default/grub
      curtin in-target --target=/target -- update-grub2
      echo "END_INSTALL_SECTION $(date '+%Y%m%d_%H%M%S')" >> /dev/ttyS0

